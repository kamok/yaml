{
  "$id": "foo",
  "$schema": "https://json-schema.org/draft-07/schema",
  "title": "RRE Build Yml",
  "description": "Validations",
  "type": "object",
  "properties": {
    "version": {
      "type": "string",
      "enum": ["v1"],
      "description": "The version of the automation to execute"
    },
    "builder": {
      "type": "string",
      "enum": ["npm", "poetry"],
      "description": "Specific package manager to use"
    },
    "type": {
      "type": "string",
      "enum": ["library", "cronjob", "microservice", "grpc-microservice", "user-interface", "process"],
      "description": "Artifact type to build: https://github.ibm.com/w3-rre/w3-rre/wiki/Artifact-Types"
    }
  },
  "required": ["builder", "type"],
  "allOf": [
    {
      "if": {
        "properties": {"type": {"const": "cronjob"}},
        "required": ["type"]
      },
      "then": {
        "required": ["cd"],
        "allOf": [{"$ref": "defs.json#/definitions/base"}],
        "properties": {
          "cd": {
            "properties": {
              "schedule": {"type": "string", "description": "Schedule in Lib"}
            },
            "required": ["schedule"]
          },
          "slackChannel": true,
          "artifactory": true,
          "productionBranches": true,
          "baseVersion": true,
          "builder": true,
          "type": true,
          "version": true
        },
        "additionalProperties": false
      }
    },
    {
      "if": {
        "properties": {"type": {"const": "library"}},
        "required": ["type"]
      },
      "then": {"allOf": [{"$ref": "defs.json#/definitions/base"}]}
    },
    {
      "if": {
        "properties": {"type": {"const": "microservice"}},
        "required": ["type"]
      },
      "then": {"allOf": [{"$ref": "defs.json#/definitions/base"}]}
    },
    {
      "if": {
        "properties": {"type": {"const": "grpc-microservice"}},
        "required": ["type"]
      },
      "then": {"allOf": [{"$ref": "defs.json#/definitions/base"}]}
    },
    {
      "if": {
        "properties": {"type": {"const": "user-interface"}},
        "required": ["type"]
      },
      "then": {"allOf": [{"$ref": "defs.json#/definitions/base"}]}
    }
  ]
}